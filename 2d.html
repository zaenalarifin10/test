<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Live2D Hiyori</title>
    <style>
        body { margin:0; background:#111; overflow:hidden; }
        canvas { position:fixed; inset:0; }
    </style>
</head>
<body>
<script src="https://unpkg.com/pixi.js@6.5.2/dist/browser/pixi.min.js"></script>
<script src="https://unpkg.com/pixi-live2d-display@4.3.0/dist/pixi-live2d-display.min.js"></script>

<script>
    const app = new PIXI.Application({
        view: document.createElement("canvas"),
        resizeTo: window,
        backgroundColor: 0x111111,
    });
    document.body.appendChild(app.view);

    // Path mengikuti struktur kamu
    const modelPath = "models/hiyori_free_t08.cdi3.json";

    PIXI.live2d.Live2DModel.from(modelPath).then(model => {
        app.stage.addChild(model);
        
        // posisi dan skala
        model.scale.set(0.45);
        model.x = window.innerWidth / 2;
        model.y = window.innerHeight;
        model.anchor.set(0.5, 1);

        // Deteksi motion di folder /motions/
        const motionDefs = model.internalModel.motionManager.definitions;
        const groups = Object.keys(motionDefs);
        let idleGroup = groups.find(g => g.toLowerCase().includes("idle"));
        if (!idleGroup) idleGroup = groups[0]; // fallback

        // Loop idle
        function idleLoop() {
            if (model.motionManager.isFinished()) {
                model.motionManager.startMotion(idleGroup, 0, 1);
            }
        }
        app.ticker.add(idleLoop);

        // Klik untuk motion berikutnya
        let index = 0;
        document.addEventListener("click", () => {
            const group = groups[0]; // grup pertama, bisa Tap/Body/Special tergantung model
            const max = motionDefs[group].length;
            index = (index + 1) % max;
            model.motionManager.startMotion(group, index, 1);
        });

    }).catch(err => console.error(err));
</script>
</body>
</html>
