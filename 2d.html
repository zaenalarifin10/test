<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Live2D Hiyori</title>
    <style>
        body { margin:0; background:#111; overflow:hidden; }
        canvas { position:fixed; inset:0; }
    </style>
</head>
<body>
<script src="https://unpkg.com/pixi.js@6.5.2/dist/browser/pixi.min.js"></script>
<script src="https://unpkg.com/pixi-live2d-display@4.3.0/dist/pixi-live2d-display.min.js"></script>

<script>
    const app = new PIXI.Application({
        view: document.createElement("canvas"),
        resizeTo: window,
        backgroundColor: 0x111111,
    });
    document.body.appendChild(app.view);

    const modelPath = "models/hiyori/hiyori_free_t08.cdi3.json";

    PIXI.live2d.Live2DModel.from(modelPath).then(model => {
        app.stage.addChild(model);

        // posisi dan ukuran
        model.scale.set(0.45);
        model.x = window.innerWidth / 2;
        model.y = window.innerHeight;
        model.anchor.set(0.5, 1);

        // follow mouse
        app.renderer.plugins.interaction.on("pointermove", (e) => {
            const pos = e.data.global;
            model.internalModel.focusController?.setFocus(pos.x / window.innerWidth, pos.y / window.innerHeight);
        });

        // LOOP idle motion
        function playIdle() {
            if (!model.motionManager.isFinished()) return;
            model.motionManager.startMotion("Idle", 0, 1);
        }
        app.ticker.add(playIdle);

        // KLIK → motion berikutnya
        let current = 0;
        document.addEventListener("click", () => {
            const motions = model.internalModel.motionManager.definitions;
            const groups = Object.keys(motions);
            if (!groups.length) return;

            const group = groups[0]; // misal "Tap" atau "Body" tergantung model
            const max = motions[group].length;
            current = (current + 1) % max;

            model.motionManager.startMotion(group, current, 1);

            // jika ada suara dengan nama sama → auto play
            const sound = `models/hiyori/sounds/${group}_${current}.mp3`;
            new Audio(sound).play().catch(()=>{});
        });
    });
</script>
</body>
</html>
